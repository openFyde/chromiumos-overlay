From 92baa656d7fcd9ec0258c0f749b6bb87e4f12583 Mon Sep 17 00:00:00 2001
From: zefuli <zefu.li@intel.com>
Date: Tue, 22 Sep 2020 15:10:17 +0000
Subject: [PATCH] Add a configuration attribute to advertise AV1d LST feature

Signed-off-by: zefuli <zefu.li@intel.com>
---
 va/va.h         |  7 +++++++
 va/va_dec_av1.h | 20 ++++++++++++++++++++
 va/va_str.c     |  1 +
 3 files changed, 28 insertions(+)

diff --git a/va/va.h b/va/va.h
index 8802bd1..71b28e6 100644
--- a/va/va.h
+++ b/va/va.h
@@ -893,6 +893,13 @@ typedef enum
      *  this setting also could be update by \c VAContextParameterUpdateBuffer
      */
     VAConfigAttribContextPriority       = 41,
+    /** \brief AV1 decoding features.  Read-only.
+     *
+     * This attribute describes the supported features of an
+     * AV1 decoder configuration.  The value returned uses the
+     * VAConfigAttribValDecAV1Features type.
+     */
+    VAConfigAttribDecAV1Features    = 42,
     /**@}*/
     VAConfigAttribTypeMax
 } VAConfigAttribType;
diff --git a/va/va_dec_av1.h b/va/va_dec_av1.h
index 8386395..aabf5b9 100644
--- a/va/va_dec_av1.h
+++ b/va/va_dec_av1.h
@@ -38,6 +38,26 @@
 extern "C" {
 #endif
 
+/** Attribute value for VAConfigAttribDecAV1Features.
+ *
+ * This attribute decribes the supported features of a AV1
+ * decoder configuration.
+ *
+ */
+typedef union VAConfigAttribValDecAV1Features {
+    struct {
+        /** large scale tile
+         *
+         * This conveys whether AV1 large scale tile is supported by HW.
+         * 0 - unsupported, 1 - supported.
+         */
+        uint32_t lst_support     : 2;
+        /* Reserved for future use. */
+        uint32_t reserved        : 30;
+    } bits;
+    uint32_t value;
+} VAConfigAttribValDecAV1Features;
+
 /**
  * \brief AV1 Decoding Picture Parameter Buffer Structure
  *
diff --git a/va/va_str.c b/va/va_str.c
index d6c0fa5..fd0282c 100644
--- a/va/va_str.c
+++ b/va/va_str.c
@@ -130,6 +130,7 @@ const char *vaConfigAttribTypeStr(VAConfigAttribType configAttribType)
     TOSTR(VAConfigAttribPredictionDirection);
     TOSTR(VAConfigAttribMultipleFrame);
     TOSTR(VAConfigAttribContextPriority);
+    TOSTR(VAConfigAttribDecAV1Features);
     case VAConfigAttribTypeMax: break;
     }
     return "<unknown config attribute type>";
-- 
2.25.1

