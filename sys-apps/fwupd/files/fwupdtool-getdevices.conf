# Copyright 2019 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description    "Gets devices' metadata using fwupdtool"
author         "chromium-os-dev@chromium.org"

# This job is started by udev via custom events.
# Job duration is expected to be O(ms).
start on fwupdtool-getdevices
task

script
  exec minijail0 \
    --profile=minimalistic-mountns --uts -e -l -p -N \
    -k /var,/var,tmpfs -b /var/run/dbus -u fwupd -g fwupd \
    -- /usr/bin/fwupdagent get-devices >/var/lib/fwupd/state.json 2>&1 |
    logger -t "${UPSTART_JOB}"
end script
